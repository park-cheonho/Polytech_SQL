REM 5_CURSOR_for_update.SQL
SET TIMING ON
SELECT TO_CHAR(SYSDATE:'HH24:MI:SS') AS START_TIME FROM DUAL;

DECLARE
	CURSOR CUR_EMP(P_DEPTNO IN NUMBER) IS
		SELECT EMPNO,ENAME,JOB,SAL,COMM FROM EMP
		WHERE DEPTNO = P_DEPTNO
		FOR UPDATE;
		--FOR UPDATE WAIT 10;
		--FOR UPDATE NOWAIT;
		
		V_DEPTNO DEPT.DEPTNO%TYPE;
BEGIN
		V_DEPTNO := 20;
		FOR R_CUR_EMP IN CUR_EMP(V_DEPTNO)
		LOOP
			UPDATE EMP
			SET COMM = ROUND(R_CUR_EMP.SAL*0.05,0)
			WHERE EMPNO = R_CUR_EMP.EMPNO;
			--WHERE CURRENT OF CUR_EMP;
	
		INSERT INTO BONUS(ENAME,JOB,SAL,COMM)
		VALUES(R_CUR_EMP.ENAME,R_CUR_EMP.JOB,R_CUR_EMP.SAL,ROUND(R_CUR_EMP.SAL*0.05,0));

			--DBMS_LOCK.SLEEP(5);

	END LOOP;
	COMMIT;
END;
/